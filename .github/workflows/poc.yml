name: PoC Victim Build

on: [push]

jobs:
  build-and-leak:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Node & PNPM
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: Install Dependencies
        run: pnpm install

      - name: ðŸš¨ VICTIM RUNS BUILD ðŸš¨
        # Ø¯ÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø§Ù„Ù„ÙŠ Ø£ÙŠ Ù…Ø·ÙˆØ± Ø£Ùˆ CI Ø¨ÙŠØ¹Ù…Ù„Ù‡Ø§
        run: |
          cd packages/react-best-practices-build
          # Ø¨Ù†Ø´ØºÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡
          npx tsx src/build.ts --skill=react-best-practices

      - name: ðŸ’€ VERIFY THE LEAK ðŸ’€
        # Ø§Ù„Ø®Ø·ÙˆØ© Ø¯ÙŠ Ø¹Ø´Ø§Ù† Ù†Ø«Ø¨Øª Ø¥Ù† Ø§Ù„Ø³Ø± Ø§ØªØ³Ø±Ù‚
        run: |
          echo "Checking for leaked /etc/passwd content inside AGENTS.md..."
          grep "root:x:0:0" skills/react-best-practices/AGENTS.md

          echo "--- LEAKED CONTENT START ---"
          head -n 5 skills/react-best-practices/AGENTS.md
          echo "--- LEAKED CONTENT END ---"
